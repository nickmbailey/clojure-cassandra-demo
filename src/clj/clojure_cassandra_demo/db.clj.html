<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/Workspace/git/clojure-cassandra-demo/src/clj/clojure_cassandra_demo/db.clj.html</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v10">
<meta name="syntax" content="clojure">
<meta name="settings" content="use_css,pre_wrap,expand_tabs">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #8a8a8a; background-color: #1c1c1c; }
body { font-family: monospace; color: #8a8a8a; background-color: #1c1c1c; }
.level9c { color: #a8a8a8; }
.level10c { color: #000000; }
.level11c { color: #c000c0; }
.level12c { color: #0000c0; }
.Constant { color: #00afaf; }
.level13c { color: #008000; }
.Special { color: #af0000; }
.Statement { color: #5f8700; }
.level14c { color: #008080; }
.Identifier { color: #0087ff; }
.level15c { color: #c00000; }
.PreProc { color: #d75f00; }
.level16c { color: #ff6060; }
-->
</style>
</head>
<body>
<pre>
<span class="level16c">(</span><span class="PreProc">ns</span> clojure-cassandra-demo.db
  <span class="level15c">(</span><span class="Identifier">require</span> <span class="level14c">[</span>qbits.hayt <span class="Statement">:refer</span><span class="level14"> </span><span class="Statement">:all</span><span class="level14c">]</span>
           <span class="level14c">[</span>qbits.alia <span class="Statement">:as</span><span class="level14"> </span><span class="clojureSymbol">alia</span><span class="level14c">]</span>
           <span class="level14c">[</span>clj-time.core <span class="Statement">:as</span><span class="level14"> </span><span class="clojureSymbol">t</span><span class="level14c">]</span>
           <span class="level14c">[</span>clj-time.coerce <span class="Statement">:as</span><span class="level14"> </span><span class="clojureSymbol">c</span><span class="level14c">]</span>
           <span class="level14c">[</span>clj-time.format <span class="Statement">:as</span><span class="level14"> </span><span class="clojureSymbol">f</span><span class="level14c">]</span><span class="level15c">)</span>
  <span class="level15c">(</span><span class="Statement">:gen-class</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="Special">def</span> cluster<span class="level16"> </span><span class="level15c">(</span><span class="clojureSymbol">alia/cluster</span> <span class="level14c">{</span><span class="Statement">:contact-points</span> <span class="level13c">[</span><span class="Constant">&quot;localhost&quot;</span><span class="level13c">]</span><span class="level14c">}</span><span class="level15c">)</span><span class="level16c">)</span>
<span class="level16c">(</span><span class="Special">def</span> session<span class="level16"> </span><span class="level15c">(</span><span class="clojureSymbol">alia/connect</span> <span class="clojureSymbol">cluster</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="Special">def</span> create-clojure-cassandra-demo
  <span class="level15c">(</span>create-keyspace <span class="Statement">:clojure_cassandra_demo</span>
    <span class="level14c">(</span>if-exists <span class="Constant">false</span><span class="level14c">)</span>
    <span class="level14c">(</span>with <span class="level13c">{</span><span class="Statement">:replication</span>
            <span class="level12c">{</span><span class="Statement">:class</span> <span class="Constant">&quot;SimpleStrategy&quot;</span>
             <span class="Statement">:replication_factor</span><span class="level12"> </span><span class="Constant">3</span><span class="level12c">}</span><span class="level13c">}</span><span class="level14c">)</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="Special">def</span> create-user-song-counts
  <span class="level15c">(</span>create-table <span class="Statement">:user_song_counts</span>
    <span class="level14c">(</span>if-exists <span class="Constant">false</span><span class="level14c">)</span>
    <span class="level14c">(</span>column-definitions <span class="level13c">{</span><span class="Statement">:username</span> <span class="Statement">:text</span>
                         <span class="Statement">:year_and_month</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:artist</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:song</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:count</span><span class="level13"> </span><span class="Statement">:counter</span>
                         <span class="Statement">:primary-key</span><span class="level13"> </span><span class="level12c">[</span><span class="level11c">[</span><span class="Statement">:username</span> <span class="Statement">:year_and_month</span><span class="level11c">]</span> <span class="Statement">:artist</span><span class="level12"> </span><span class="Statement">:song</span><span class="level12c">]</span><span class="level13c">}</span><span class="level14c">)</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="Special">def</span> create-artist-song-counts
  <span class="level15c">(</span>create-table <span class="Statement">:artist_song_counts</span>
    <span class="level14c">(</span>if-exists <span class="Constant">false</span><span class="level14c">)</span>
    <span class="level14c">(</span>column-definitions <span class="level13c">{</span><span class="Statement">:artist</span> <span class="Statement">:text</span>
                         <span class="Statement">:year_and_week</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:album</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:song</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:count</span><span class="level13"> </span><span class="Statement">:counter</span>
                         <span class="Statement">:primary-key</span><span class="level13"> </span><span class="level12c">[</span><span class="level11c">[</span><span class="Statement">:artist</span> <span class="Statement">:year_and_week</span><span class="level11c">]</span> <span class="Statement">:album</span><span class="level12"> </span><span class="Statement">:song</span><span class="level12c">]</span><span class="level13c">}</span><span class="level14c">)</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="Special">def</span> create-artist-history
  <span class="level15c">(</span>create-table <span class="Statement">:artist_history</span>
    <span class="level14c">(</span>if-exists <span class="Constant">false</span><span class="level14c">)</span>
    <span class="level14c">(</span>column-definitions <span class="level13c">{</span><span class="Statement">:artist</span> <span class="Statement">:text</span>
                         <span class="Statement">:year_and_week</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:played_at</span><span class="level13"> </span><span class="Statement">:timestamp</span>
                         <span class="Statement">:username</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:song</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:album</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:primary-key</span><span class="level13"> </span><span class="level12c">[</span><span class="level11c">[</span><span class="Statement">:artist</span> <span class="Statement">:year_and_week</span><span class="level11c">]</span> <span class="Statement">:played_at</span><span class="level12c">]</span><span class="level13c">}</span><span class="level14c">)</span>
    <span class="level14c">(</span>with <span class="level13c">{</span><span class="Statement">:clustering-order</span> <span class="level12c">[</span><span class="level11c">[</span><span class="Statement">:played_at</span> <span class="Statement">:desc</span><span class="level11c">]</span><span class="level12c">]</span><span class="level13c">}</span><span class="level14c">)</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="Special">def</span> create-song-history
  <span class="level15c">(</span>create-table <span class="Statement">:song_history</span>
    <span class="level14c">(</span>if-exists <span class="Constant">false</span><span class="level14c">)</span>
    <span class="level14c">(</span>column-definitions <span class="level13c">{</span><span class="Statement">:song</span> <span class="Statement">:text</span>
                         <span class="Statement">:year_and_week</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:played_at</span><span class="level13"> </span><span class="Statement">:timestamp</span>
                         <span class="Statement">:username</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:artist</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:album</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:primary-key</span><span class="level13"> </span><span class="level12c">[</span><span class="level11c">[</span><span class="Statement">:song</span> <span class="Statement">:year_and_week</span><span class="level11c">]</span> <span class="Statement">:played_at</span><span class="level12c">]</span><span class="level13c">}</span><span class="level14c">)</span>
    <span class="level14c">(</span>with <span class="level13c">{</span><span class="Statement">:clustering-order</span> <span class="level12c">[</span><span class="level11c">[</span><span class="Statement">:played_at</span> <span class="Statement">:desc</span><span class="level11c">]</span><span class="level12c">]</span><span class="level13c">}</span><span class="level14c">)</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="Special">def</span> create-user-history
  <span class="level15c">(</span>create-table <span class="Statement">:user_history</span>
    <span class="level14c">(</span>if-exists <span class="Constant">false</span><span class="level14c">)</span>
    <span class="level14c">(</span>column-definitions <span class="level13c">{</span><span class="Statement">:username</span> <span class="Statement">:text</span>
                         <span class="Statement">:year_and_month</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:played_at</span><span class="level13"> </span><span class="Statement">:timestamp</span>
                         <span class="Statement">:song</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:artist</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:album</span><span class="level13"> </span><span class="Statement">:text</span>
                         <span class="Statement">:primary-key</span><span class="level13"> </span><span class="level12c">[</span><span class="level11c">[</span><span class="Statement">:username</span> <span class="Statement">:year_and_month</span><span class="level11c">]</span> <span class="Statement">:played_at</span><span class="level12c">]</span><span class="level13c">}</span><span class="level14c">)</span>
    <span class="level14c">(</span>with <span class="level13c">{</span><span class="Statement">:clustering-order</span> <span class="level12c">[</span><span class="level11c">[</span><span class="Statement">:played_at</span> <span class="Statement">:desc</span><span class="level11c">]</span><span class="level12c">]</span><span class="level13c">}</span><span class="level14c">)</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="PreProc">defn</span> track-played<span class="level16"> </span><span class="level15c">[</span><span class="clojureSymbol">username</span> <span class="clojureSymbol">played-at</span><span class="level15"> </span><span class="clojureSymbol">song</span><span class="level15"> </span><span class="clojureSymbol">artist</span><span class="level15"> </span><span class="clojureSymbol">album</span><span class="level15c">]</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="level14c">(</span><span class="clojureSymbol">use-keyspace</span> <span class="Statement">:clojure_cassandra_demo</span><span class="level14c">)</span><span class="level15c">)</span>
  <span class="level15c">(</span><span class="Special">let</span> <span class="level14c">[</span>played-at-datetime <span class="level13c">(</span><span class="clojureSymbol">c/from-long</span> <span class="clojureSymbol">played-at</span><span class="level13c">)</span>
        year-and-month<span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">f/unparse</span> <span class="level12c">(</span><span class="clojureSymbol">f/formatters</span> <span class="Statement">:year-month</span><span class="level12c">)</span><span class="level13"> </span><span class="clojureSymbol">played-at-datetime</span><span class="level13c">)</span>
        year-and-week<span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">f/unparse</span> <span class="level12c">(</span><span class="clojureSymbol">f/formatters</span> <span class="Statement">:weekyear-week</span><span class="level12c">)</span><span class="level13"> </span><span class="clojureSymbol">played-at-datetime</span><span class="level13c">)</span>
        p1<span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">alia/execute-async</span> <span class="clojureSymbol">session</span>
             <span class="level12c">(</span>insert <span class="Statement">:user_history</span>
               <span class="level11c">(</span>values
                 <span class="Statement">:username</span><span class="level11"> </span>username
                 <span class="Statement">:year_and_month</span><span class="level11"> </span>year-and-month
                 <span class="Statement">:played_at</span><span class="level11"> </span>played-at
                 <span class="Statement">:song</span><span class="level11"> </span>song
                 <span class="Statement">:artist</span><span class="level11"> </span>artist
                 <span class="Statement">:album</span><span class="level11"> </span>album<span class="level11c">)</span><span class="level12c">)</span><span class="level13c">)</span>
        p2<span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">alia/execute-async</span> <span class="clojureSymbol">session</span>
             <span class="level12c">(</span>update <span class="Statement">:user_song_counts</span>
               <span class="level11c">(</span>set-columns
                 <span class="level10c">{</span><span class="Statement">:count</span> <span class="level9c">[</span><span class="Identifier">+</span> <span class="Constant">1</span><span class="level9c">]</span><span class="level10c">}</span><span class="level11c">)</span>
               <span class="level11c">(</span>where <span class="level10c">[</span><span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:username</span><span class="level9"> </span><span class="clojureSymbol">username</span><span class="level9c">]</span>
                       <span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:artist</span><span class="level9"> </span>artist<span class="level9c">]</span>
                       <span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:song</span><span class="level9"> </span>song<span class="level9c">]</span>
                       <span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:year_and_month</span><span class="level9"> </span>year-and-month<span class="level9c">]</span><span class="level10c">]</span><span class="level11c">)</span><span class="level12c">)</span><span class="level13c">)</span>
        p2<span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">alia/execute-async</span> <span class="clojureSymbol">session</span>
             <span class="level12c">(</span>update <span class="Statement">:artist_song_counts</span>
               <span class="level11c">(</span>set-columns
                 <span class="level10c">{</span><span class="Statement">:count</span> <span class="level9c">[</span><span class="Identifier">+</span> <span class="Constant">1</span><span class="level9c">]</span><span class="level10c">}</span><span class="level11c">)</span>
               <span class="level11c">(</span>where <span class="level10c">[</span><span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:artist</span><span class="level9"> </span><span class="clojureSymbol">artist</span><span class="level9c">]</span>
                       <span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:album</span><span class="level9"> </span>album<span class="level9c">]</span>
                       <span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:song</span><span class="level9"> </span>song<span class="level9c">]</span>
                       <span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:year_and_week</span><span class="level9"> </span>year-and-week<span class="level9c">]</span><span class="level10c">]</span><span class="level11c">)</span><span class="level12c">)</span><span class="level13c">)</span>
        p3<span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">alia/execute-async</span> <span class="clojureSymbol">session</span>
             <span class="level12c">(</span>insert <span class="Statement">:song_history</span>
               <span class="level11c">(</span>values
                 <span class="Statement">:song</span><span class="level11"> </span>song
                 <span class="Statement">:year_and_week</span><span class="level11"> </span>year-and-week
                 <span class="Statement">:played_at</span><span class="level11"> </span>played-at
                 <span class="Statement">:username</span><span class="level11"> </span>username
                 <span class="Statement">:artist</span><span class="level11"> </span>artist
                 <span class="Statement">:album</span><span class="level11"> </span>album<span class="level11c">)</span><span class="level12c">)</span><span class="level13c">)</span>
        p4<span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">alia/execute-async</span> <span class="clojureSymbol">session</span>
             <span class="level12c">(</span>insert <span class="Statement">:artist_history</span>
               <span class="level11c">(</span>values
                 <span class="Statement">:artist</span><span class="level11"> </span>artist
                 <span class="Statement">:year_and_week</span><span class="level11"> </span>year-and-week
                 <span class="Statement">:played_at</span><span class="level11"> </span>played-at
                 <span class="Statement">:username</span><span class="level11"> </span>username
                 <span class="Statement">:song</span><span class="level11"> </span>song
                 <span class="Statement">:album</span><span class="level11"> </span>album<span class="level11c">)</span><span class="level12c">)</span><span class="level13c">)</span><span class="level14c">]</span>
    <span class="Special">@</span>p1<span class="level15"> </span><span class="Special">@</span><span class="clojureSymbol">p2</span><span class="level15"> </span><span class="Special">@</span><span class="clojureSymbol">p3</span><span class="level15"> </span><span class="Special">@</span><span class="clojureSymbol">p4</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="PreProc">defn</span> get-artist-popular-songs<span class="level16"> </span><span class="level15c">[</span><span class="clojureSymbol">artist</span> <span class="clojureSymbol">year-and-week</span><span class="level15c">]</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="level14c">(</span><span class="clojureSymbol">use-keyspace</span> <span class="Statement">:clojure_cassandra_demo</span><span class="level14c">)</span><span class="level15c">)</span>
  <span class="level15c">(</span><span class="Special">let</span> <span class="level14c">[</span>results <span class="level13c">(</span><span class="clojureSymbol">alia/execute</span>
                  session
                  <span class="level12c">(</span>select
                    <span class="Statement">:artist_song_counts</span>
                    <span class="level11c">(</span>where <span class="level10c">[</span><span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:artist</span><span class="level9"> </span><span class="clojureSymbol">artist</span><span class="level9c">]</span>
                            <span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:year_and_week</span><span class="level9"> </span>year-and-week<span class="level9c">]</span><span class="level10c">]</span><span class="level11c">)</span><span class="level12c">)</span><span class="level13c">)</span><span class="level14c">]</span>
    <span class="level14c">(</span><span class="PreProc">-&gt;&gt;</span> results
      <span class="level13c">(</span><span class="Identifier">sort-by</span> <span class="Statement">:count</span><span class="level13c">)</span>
      <span class="level13c">(</span><span class="Identifier">reverse</span><span class="level13c">)</span>
      <span class="level13c">(</span><span class="Identifier">take</span> <span class="Constant">10</span><span class="level13c">)</span><span class="level14c">)</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="PreProc">defn</span> get-user-favorite-songs<span class="level16"> </span><span class="level15c">[</span><span class="clojureSymbol">username</span> <span class="clojureSymbol">year</span><span class="level15"> </span><span class="clojureSymbol">month</span><span class="level15c">]</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="level14c">(</span><span class="clojureSymbol">use-keyspace</span> <span class="Statement">:clojure_cassandra_demo</span><span class="level14c">)</span><span class="level15c">)</span>
  <span class="level15c">(</span><span class="Special">let</span> <span class="level14c">[</span>dt <span class="level13c">(</span><span class="clojureSymbol">t/date-time</span> <span class="clojureSymbol">year</span><span class="level13"> </span><span class="clojureSymbol">month</span><span class="level13c">)</span>
        year-and-month<span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">f/unparse</span> <span class="level12c">(</span><span class="clojureSymbol">f/formatters</span> <span class="Statement">:year-month</span><span class="level12c">)</span><span class="level13"> </span><span class="clojureSymbol">dt</span><span class="level13c">)</span>
        results<span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">alia/execute</span>
                  session
                  <span class="level12c">(</span>select
                    <span class="Statement">:user_song_counts</span>
                    <span class="level11c">(</span>where <span class="level10c">[</span><span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:username</span><span class="level9"> </span><span class="clojureSymbol">username</span><span class="level9c">]</span>
                            <span class="level9c">[</span><span class="Identifier">=</span> <span class="Statement">:year_and_month</span><span class="level9"> </span>year-and-month<span class="level9c">]</span><span class="level10c">]</span><span class="level11c">)</span><span class="level12c">)</span><span class="level13c">)</span><span class="level14c">]</span>
    <span class="level14c">(</span><span class="PreProc">-&gt;&gt;</span> results
      <span class="level13c">(</span><span class="Identifier">sort-by</span> <span class="Statement">:count</span><span class="level13c">)</span>
      <span class="level13c">(</span><span class="Identifier">reverse</span><span class="level13c">)</span>
      <span class="level13c">(</span><span class="Identifier">take</span> <span class="Constant">10</span><span class="level13c">)</span><span class="level14c">)</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="PreProc">defn</span> get-user-history<span class="level16"> </span><span class="level15c">[</span><span class="clojureSymbol">username</span> <span class="clojureSymbol">year</span><span class="level15"> </span><span class="clojureSymbol">month</span><span class="level15c">]</span>
   <span class="level15c">(</span><span class="Special">let</span> <span class="level14c">[</span>dt <span class="level13c">(</span><span class="clojureSymbol">t/date-time</span> <span class="clojureSymbol">year</span><span class="level13"> </span><span class="clojureSymbol">month</span><span class="level13c">)</span>
         year-and-month<span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">f/unparse</span> <span class="level12c">(</span><span class="clojureSymbol">f/formatters</span> <span class="Statement">:year-month</span><span class="level12c">)</span><span class="level13"> </span><span class="clojureSymbol">dt</span><span class="level13c">)</span><span class="level14c">]</span>
    <span class="level14c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">use-keyspace</span> <span class="Statement">:clojure_cassandra_demo</span><span class="level13c">)</span><span class="level14c">)</span>
    <span class="level14c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level14"> </span><span class="level13c">(</span><span class="clojureSymbol">select</span>
                            <span class="Statement">:user_history</span>
                            <span class="level12c">(</span>where <span class="level11c">[</span><span class="level10c">[</span><span class="Identifier">=</span> <span class="Statement">:username</span><span class="level10"> </span><span class="clojureSymbol">username</span><span class="level10c">]</span>
                                    <span class="level10c">[</span><span class="Identifier">=</span> <span class="Statement">:year_and_month</span><span class="level10"> </span>year-and-month<span class="level10c">]</span><span class="level11c">]</span><span class="level12c">)</span><span class="level13c">)</span><span class="level14c">)</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="PreProc">defn</span> get-artist-history<span class="level16"> </span><span class="level15c">[</span><span class="clojureSymbol">artist</span> <span class="clojureSymbol">year-and-week</span><span class="level15c">]</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="level14c">(</span><span class="clojureSymbol">use-keyspace</span> <span class="Statement">:clojure_cassandra_demo</span><span class="level14c">)</span><span class="level15c">)</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="level14c">(</span><span class="clojureSymbol">select</span>
                          <span class="Statement">:artist_history</span>
                          <span class="level13c">(</span>where <span class="level12c">[</span><span class="level11c">[</span><span class="Identifier">=</span> <span class="Statement">:artist</span><span class="level11"> </span><span class="clojureSymbol">artist</span><span class="level11c">]</span>
                                  <span class="level11c">[</span><span class="Identifier">=</span> <span class="Statement">:year_and_week</span><span class="level11"> </span>year-and-week<span class="level11c">]</span><span class="level12c">]</span><span class="level13c">)</span><span class="level14c">)</span><span class="level15c">)</span><span class="level16c">)</span>

<span class="level16c">(</span><span class="PreProc">defn</span> init-db<span class="level16"> </span><span class="level15c">[]</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="clojureSymbol">create-clojure-cassandra-demo</span><span class="level15c">)</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="level14c">(</span><span class="clojureSymbol">use-keyspace</span> <span class="Statement">:clojure_cassandra_demo</span><span class="level14c">)</span><span class="level15c">)</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="clojureSymbol">create-user-song-counts</span><span class="level15c">)</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="clojureSymbol">create-artist-song-counts</span><span class="level15c">)</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="clojureSymbol">create-user-history</span><span class="level15c">)</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="clojureSymbol">create-song-history</span><span class="level15c">)</span>
  <span class="level15c">(</span>alia/execute <span class="clojureSymbol">session</span><span class="level15"> </span><span class="clojureSymbol">create-artist-history</span><span class="level15c">)</span><span class="level16c">)</span>
</pre>
</body>
</html>
